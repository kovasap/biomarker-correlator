{"version":3,"sources":["app/csv.cljs"],"mappings":";;;AAQA,AAAKA,mBAAS,gDAAA,2CAAA,iEAAA,mFAAA,2CAAA,0EAAA,mFAAA,vbAACC;AAGf,sBAAA,tBAAMC,oDAAaC;AAAnB,AACE,OAACC,qDAAc,AAACC,qBAAQF;;AAK1B,AAAKG,qBACH,AAACC,4CAAI,WAAKC;AAAL,AACE,IAAMC,SAAO,AAAiBD;IACxBE,QAASD,DAAe,CAAA,aAAA;AAD9B,AAEE,gBAAA,fAAM,AAASA;;AACfC;;AAEX,uBAAA,vBAAMC,sDAAcC;AAApB,AACE,8bAAA,2EAAA,lgBAACC,0DACA,AAACC,6CAAUF,SAAS,qBAAA,2CAAA,2DAAA,KAAA,6EAAA,KAAA,oDAAA,tQAACP;;AAKxB,AAAKU,yBACH,4CAAA,WAAAC,vDAACT;AAAD,AAAM,4BAAA,AAAA,AAAAS,rBAAwBL;;AAIhC,AAAKM,4BAAkB,mDAAA,nDAACC,uDAAOZ;AAC/B,AAAKa,2BAAiB,mDAAA,nDAACD,uDAAOH;AAE9B,IAAAK,yBAAA,AAAAF,mDAAA;AAAA,AAAA,AAAAG,kCAAA;AAAA,AAAA,IAAAC,mBAAA,iBAAAC,wBAAA,WAAAC;AAAA,AAAA,IAAAC,kBAAA,CAAAD,YAAA;AAAA,AAAA,GAAA,CAAAC,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,AAAA,IAAAE,uBAAAF;AAAA,AAAA,CAAAE,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA,GAAA,CAAAD,oBAAA;AAAA,IAAAE,aAAA,KAAAC;IAAAJ,kBAAA,iBAAAK,iBAAAL;AAAA,AAAA,CAAAK,eAAA,OAAAF;;AAAAE;;AAAA,AAAA,OAAAC,4CAAAN,gBAAA,IAEiBP;;AAFjB,GAAA,CAAAQ,oBAAA;AAAA,IAAAM,aAAA,CAAAP,YAAA;IAAAA,kBAAAA;AAAA,AAAA,OAAAQ,6CAAAR,gBAAAO;;AAAA,GAAA,CAAAN,oBAAA;AAAA,IAAAE,aAAA,CAAAH,YAAA;IAAAS,aAAA,CAAAT,YAAA;IAAAU,aAAA,AAAAD;IAAAE,aAAA,oFAAA,4EAAAD,hKAGKwB,mDAAM1D,iBAAS2D;IAHpBvB,aAAA,0BAAAT,TACQ8B;WADRxB,PAEQvB;AAFR,AAAA,kBAAA2B;AAAA,AAI6B,wFAAAA,jFAACuB,wDAAKzC;;;IAJnCmB,aAAA,CAAA,AAAAX,oBAAAS;IAAAG,aAAA,AAAAZ,sBAAAM;IAAAT,kBAAA,iBAAAgB,iBAAAhB;AAAA,AAAA,CAAAgB,eAAA,OAAAF;;AAAA,CAAAE,eAAA,OAAAL;;AAAA,CAAAK,eAAA,QAAAD;;AAAAC;;AAAA,AAAA,AAAA,IAAAC,uBAAAjB;AAAA,AAAA,CAAAiB,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA;;;;;;AAAA,AAAA;;;AAAA,AAAA,IAAAC,iBAAA,CAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA;AAAA,AAAA,CAAAA,eAAA,OAAAC;;AAAA,CAAAD,eAAA,OAAA;;AAAAA;;yDAAAlB;;AAAA,AAAA,IAAAoB,2BAAA,iBAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA,AAAAtB,sBAAAC;AAAA,AAAA,GAAA,AAAAsB,mCAAAD,sBAAA;AAAA;;AAAAA;;;;gBAAA,IAAAE,oBAAAC;AAAA,AAAA,IAAAC,uBAAAzB;AAAA,AAAA,CAAAyB,qBAAA,OAAAF;;AAAAE;AAAA,GAAA,AAAAC,cAAA,CAAA1B,YAAA;AAAA,IAAA2B,uBAAA3B;AAAA,AAAA,CAAA2B,qBAAA,OAAA,AAAAC,gBAAA,CAAA5B,YAAA;;AAAA2B;AAAA,MAAAJ;;;AAAA;;AAAA,AAAA,GAAA,AAAAD,mCAAAF,yBAAA;AAAA,eAAApB;;;;AAAAoB;;;;;gDAAApB;;;;;yDAAAA;;;;;;;;;IAAA6B,uBAAA,iBAAAC,iBAAA,AAAAhC;AAAA,AAAA,CAAAgC,eAAAC,AAAA,OAAAnC;;AAAAkC;;AAAA,AAAA,OAAAE,2DAAAH;;;AAAAjC,AAQA,IAAAA,yBAAA,AAAAF,mDAAA;AAAA,AAAA,AAAAG,kCAAA;AAAA,AAAA,IAAAC,mBAAA,iBAAAC,wBAAA,WAAAsC;AAAA,AAAA,IAAAC,kBAAA,CAAAD,YAAA;AAAA,AAAA,GAAA,CAAAC,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,AAAA,IAAAE,uBAAAF;AAAA,AAAA,CAAAE,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA,GAAA,CAAAD,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,OAAA/B,4CAAA+B,gBAAA,IACwC1C;;AADxC,GAAA,CAAA2C,oBAAA;AAAA,IAAAE,aAAA,CAAAH,YAAA;IAAAA,kBAAAA;AAAA,AAAA,OAAA7B,6CAAA6B,gBAAAG;;AAAA,GAAA,CAAAF,oBAAA;AAAA,IAAAG,aAAA,CAAAJ,YAAA;IAAAK,aAAA,oFAAA,iEAAAD,rJACGP,mDAAM1D,iBAAS2D;IADlBE,kBAAA,iBAAAM,iBAAAN;AAAA,AAAA,CAAAM,eAAA,OAAAD;;AAAAC;;AAAA,AAAA,AAAA,IAAAC,uBAAAP;AAAA,AAAA,CAAAO,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA;;;;;;AAAA,AAAA;;;AAAA,AAAA,IAAAC,iBAAA,CAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA;AAAA,AAAA,CAAAA,eAAA,OAAA1B;;AAAA,CAAA0B,eAAA,OAAA;;AAAAA;;yDAAAR;;AAAA,AAAA,IAAAjB,2BAAA,iBAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA,AAAAtB,sBAAAsC;AAAA,AAAA,GAAA,AAAAf,mCAAAD,sBAAA;AAAA;;AAAAA;;;;gBAAA,IAAAE,oBAAAuB;AAAA,AAAA,IAAAC,uBAAAV;AAAA,AAAA,CAAAU,qBAAA,OAAAxB;;AAAAwB;AAAA,GAAA,AAAArB,cAAA,CAAAW,YAAA;AAAA,IAAAW,uBAAAX;AAAA,AAAA,CAAAW,qBAAA,OAAA,AAAApB,gBAAA,CAAAS,YAAA;;AAAAW;AAAA,MAAAzB;;;AAAA;;AAAA,AAAA,GAAA,AAAAD,mCAAAF,yBAAA;AAAA,eAAAiB;;;;AAAAjB;;;;;gDAAAiB;;;;;yDAAAA;;;;;;;;;IAAAR,uBAAA,iBAAAoB,iBAAA,AAAAnD;AAAA,AAAA,CAAAmD,eAAAlB,AAAA,OAAAnC;;AAAAqD;;AAAA,AAAA,OAAAjB,2DAAAH;;;AAAAjC,AAKA,AAAKsD,gCAAsB,mDAAA,nDAACxD,uDAAOZ;AACnC,AAAKqE,+BAAqB,mDAAA,nDAACzD,uDAAOH;AAElC,IAAAK,yBAAA,AAAAF,mDAAA;AAAA,AAAA,AAAAG,kCAAA;AAAA,AAAA,IAAAC,mBAAA,iBAAAC,wBAAA,WAAAqD;AAAA,AAAA,IAAAC,kBAAA,CAAAD,YAAA;AAAA,AAAA,GAAA,CAAAC,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,AAAA,IAAAE,uBAAAF;AAAA,AAAA,CAAAE,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA,GAAA,CAAAD,oBAAA;AAAA,IAAAE,aAAA,KAAAnD;IAAAgD,kBAAA,iBAAAI,iBAAAJ;AAAA,AAAA,CAAAI,eAAA,OAAAD;;AAAAC;;AAAA,AAAA,OAAAlD,4CAAA8C,gBAAA,IAEiBF;;AAFjB,GAAA,CAAAG,oBAAA;AAAA,IAAAI,aAAA,CAAAL,YAAA;IAAAA,kBAAAA;AAAA,AAAA,OAAA5C,6CAAA4C,gBAAAK;;AAAA,GAAA,CAAAJ,oBAAA;AAAA,IAAAE,aAAA,CAAAH,YAAA;IAAAM,aAAA,CAAAN,YAAA;IAAAO,aAAA,AAAAD;IAAAE,aAAA,oFAAA,mFAAAD,vKAGKzB,mDAAM1D,iBAAS2D;IAHpB0B,aAAA,0BAAAN,TACQtB;WADRyB,PAEQxE;AAFR,AAAA,kBAAA4E;AAAA,AAI6B,4FAAAA,rFAAC1B,wDAAKe;;;IAJnCY,aAAA,CAAA,AAAAR,oBAAAM;IAAAG,aAAA,AAAAT,sBAAAG;IAAAN,kBAAA,iBAAAa,iBAAAb;AAAA,AAAA,CAAAa,eAAA,OAAAD;;AAAA,CAAAC,eAAA,OAAAF;;AAAA,CAAAE,eAAA,QAAAL;;AAAAK;;AAAA,AAAA,AAAA,IAAAC,uBAAAd;AAAA,AAAA,CAAAc,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA;;;;;;AAAA,AAAA;;;AAAA,AAAA,IAAAC,iBAAA,CAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA;AAAA,AAAA,CAAAA,eAAA,OAAAhD;;AAAA,CAAAgD,eAAA,OAAA;;AAAAA;;yDAAAf;;AAAA,AAAA,IAAAhC,2BAAA,iBAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA,AAAAtB,sBAAAqD;AAAA,AAAA,GAAA,AAAA9B,mCAAAD,sBAAA;AAAA;;AAAAA;;;;gBAAA,IAAAE,oBAAA6C;AAAA,AAAA,IAAAC,uBAAAjB;AAAA,AAAA,CAAAiB,qBAAA,OAAA9C;;AAAA8C;AAAA,GAAA,AAAA3C,cAAA,CAAA0B,YAAA;AAAA,IAAAkB,uBAAAlB;AAAA,AAAA,CAAAkB,qBAAA,OAAA,AAAA1C,gBAAA,CAAAwB,YAAA;;AAAAkB;AAAA,MAAA/C;;;AAAA;;AAAA,AAAA,GAAA,AAAAD,mCAAAF,yBAAA;AAAA,eAAAgC;;;;AAAAhC;;;;;gDAAAgC;;;;;yDAAAA;;;;;;;;;IAAAvB,uBAAA,iBAAA0C,iBAAA,AAAAzE;AAAA,AAAA,CAAAyE,eAAAxC,AAAA,OAAAnC;;AAAA2E;;AAAA,AAAA,OAAAvC,2DAAAH;;;AAAAjC,AAQA,IAAAA,yBAAA,AAAAF,mDAAA;AAAA,AAAA,AAAAG,kCAAA;AAAA,AAAA,IAAAC,mBAAA,iBAAAC,wBAAA,WAAAyE;AAAA,AAAA,IAAAC,kBAAA,CAAAD,YAAA;AAAA,AAAA,GAAA,CAAAC,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,AAAA,IAAAE,uBAAAF;AAAA,AAAA,CAAAE,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA,GAAA,CAAAD,oBAAA;AAAA,IAAAD,kBAAAA;AAAA,AAAA,OAAAlE,4CAAAkE,gBAAA,IAC4CrB;;AAD5C,GAAA,CAAAsB,oBAAA;AAAA,IAAAE,aAAA,CAAAH,YAAA;IAAAA,kBAAAA;AAAA,AAAA,OAAAhE,6CAAAgE,gBAAAG;;AAAA,GAAA,CAAAF,oBAAA;AAAA,IAAAG,aAAA,CAAAJ,YAAA;IAAAK,aAAA,oFAAA,0EAAAD,9JACG1C,mDAAM1D,iBAAS2D;IADlBqC,kBAAA,iBAAAM,iBAAAN;AAAA,AAAA,CAAAM,eAAA,OAAAD;;AAAAC;;AAAA,AAAA,AAAA,IAAAC,uBAAAP;AAAA,AAAA,CAAAO,qBAAA,OAAA;;AAAA,CAAAA,qBAAA,OAAA;;AAAAA;AAAA;;AAAA;;;;;;AAAA,AAAA;;;AAAA,AAAA,IAAAC,iBAAA,CAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA;AAAA,AAAA,CAAAA,eAAA,OAAA7D;;AAAA,CAAA6D,eAAA,OAAA;;AAAAA;;yDAAAR;;AAAA,AAAA,IAAApD,2BAAA,iBAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA,AAAAtB,sBAAAyE;AAAA,AAAA,GAAA,AAAAlD,mCAAAD,sBAAA;AAAA;;AAAAA;;;;gBAAA,IAAAE,oBAAA0D;AAAA,AAAA,IAAAC,uBAAAV;AAAA,AAAA,CAAAU,qBAAA,OAAA3D;;AAAA2D;AAAA,GAAA,AAAAxD,cAAA,CAAA8C,YAAA;AAAA,IAAAW,uBAAAX;AAAA,AAAA,CAAAW,qBAAA,OAAA,AAAAvD,gBAAA,CAAA4C,YAAA;;AAAAW;AAAA,MAAA5D;;;AAAA;;AAAA,AAAA,GAAA,AAAAD,mCAAAF,yBAAA;AAAA,eAAAoD;;;;AAAApD;;;;;gDAAAoD;;;;;yDAAAA;;;;;;;;;IAAA3C,uBAAA,iBAAAuD,iBAAA,AAAAtF;AAAA,AAAA,CAAAsF,eAAArD,AAAA,OAAAnC;;AAAAwF;;AAAA,AAAA,OAAApD,2DAAAH;;;AAAAjC,AAIA,qBAAA,rBAAM0F,kDAAYC,UAAUC;AAA5B,AAAA,0FAAA,+EAAA,mFAAA,6EAAA,mFAAA,6EAAA,2CAAA,qDAAA,OAAA,yDAAA,OAAA,+DAAA,WAAAH;AAAA,AAI8C,mFAAAA,5EAACjD,wDAAKoD;mBAJpD,mFAAA,uEAAA,mFAAA,wEAAA,mFAAA,qGAAA,mFAAA,2EAQuB,iBAAAC,mBAAIF;AAAJ,AAAA,oBAAAE;AAAAA;;AAAA","names":["app.csv/csv-data","reagent.core.atom","app.csv/maps-to-csv","maps","js/module$node_modules$csv_stringify$lib$sync.stringify","cljs.core/clj->js","app.csv/first-file","cljs.core.map","e","target","file","app.csv/my-parse-csv","csv-data","cljs.core.js__GT_clj","js/module$node_modules$csv_parse$lib$sync.parse","app.csv/extract-result","p1__42743#","app.csv/input-upload-reqs","cljs.core.async.chan","app.csv/input-file-reads","c__26640__auto__","cljs.core.async.impl.dispatch/run","f__26641__auto__","switch__26555__auto__","state_42770","state_val_42772","statearr-42776","inst_42753","js/FileReader","statearr-42777","cljs.core.async.impl.ioc-helpers/take!","inst_42767","cljs.core.async.impl.ioc-helpers/return-chan","inst_42755","inst_42756","inst_42757","inst_42761","p1__42751#","inst_42762","inst_42763","statearr-42779","statearr-42783","statearr-42784","state-machine__26556__auto__","ret-value__26557__auto__","result__26558__auto__","cljs.core/keyword-identical?","ex__26559__auto__","e42787","statearr-42789","cljs.core/seq","statearr-42790","cljs.core/first","state__26642__auto__","statearr-42794","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","reader","cljs.core.swap_BANG_","cljs.core/assoc","cljs.core.async.put_BANG_","state_42803","state_val_42804","statearr-42805","inst_42801","inst_42797","inst_42798","statearr-42806","statearr-42807","statearr-42808","e42809","statearr-42810","statearr-42811","statearr-42812","app.csv/biomarker-upload-reqs","app.csv/biomarker-file-reads","state_42827","state_val_42828","statearr-42829","inst_42815","statearr-42830","inst_42825","inst_42817","inst_42818","inst_42819","inst_42820","p1__42813#","inst_42821","inst_42822","statearr-42831","statearr-42832","statearr-42833","e42836","statearr-42837","statearr-42838","statearr-42841","state_42850","state_val_42851","statearr-42857","inst_42848","inst_42844","inst_42845","statearr-42860","statearr-42865","statearr-42867","e42868","statearr-42869","statearr-42870","statearr-42873","p1__42875#","app.csv/upload-btn","file-name","upload-reqs-channel","or__4253__auto__"],"sourcesContent":["(ns app.csv\n  (:require\n   [\"csv-parse/lib/sync\" :rename {parse parse-csv}]\n   [\"csv-stringify/lib/sync\" :rename {stringify stringify-csv}]\n   [cljs.core.async :refer [chan put! take! >! <! buffer dropping-buffer sliding-buffer timeout close! alts!]]\n   [cljs.core.async :refer-macros [go go-loop alt!]]\n   [reagent.core :as r]))\n\n(def csv-data (r/atom {:input-data [{}]\n                       :biomarker-data [{}]}))\n\n(defn maps-to-csv [maps]\n  (stringify-csv (clj->js maps)))\n\n;; -------- Data \"Uploading\" --------------------------------------------\n;; From https://mrmcc3.github.io/blog/posts/csv-with-clojurescript/ \n\n(def first-file\n  (map (fn [e]\n         (let [target (.-currentTarget e)\n               file (-> target .-files (aget 0))]\n           (set! (.-value target) \"\")\n           file))))\n\n(defn my-parse-csv [csv-data]\n  (js->clj\n   (parse-csv csv-data (clj->js {:columns true\n                                 :skip_empty_lines true\n                                 :trim true}))\n   :keywordize-keys true))\n\n(def extract-result\n  (map #(-> % .-target .-result my-parse-csv)))\n\n;;; Input data file\n\n(def input-upload-reqs (chan 1 first-file))\n(def input-file-reads (chan 1 extract-result))\n\n(go-loop []\n  (let [reader (js/FileReader.)\n        file (<! input-upload-reqs)]\n    (swap! csv-data assoc :input-file-name (.-name file))\n    (set! (.-onload reader) #(put! input-file-reads %))\n    (.readAsText reader file)\n    (recur)))\n\n(go-loop []\n  (swap! csv-data assoc :input-data (<! input-file-reads))\n  (recur))\n\n;; Biomarker data file\n(def biomarker-upload-reqs (chan 1 first-file))\n(def biomarker-file-reads (chan 1 extract-result))\n\n(go-loop []\n  (let [reader (js/FileReader.)\n        file (<! biomarker-upload-reqs)]\n    (swap! csv-data assoc :biomarker-file-name (.-name file))\n    (set! (.-onload reader) #(put! biomarker-file-reads %))\n    (.readAsText reader file)\n    (recur)))\n\n(go-loop []\n  (swap! csv-data assoc :biomarker-data (<! biomarker-file-reads))\n  (recur))\n\n(defn upload-btn [file-name upload-reqs-channel]\n  [:span.upload-label\n   [:label.file-label\n    [:input.file-input\n     {:type \"file\" :accept \".csv\" :on-change #(put! upload-reqs-channel %)}]\n    [:span.file-cta\n     [:span.file-icon\n      [:i.fa.fa-upload.fa-lg]]\n     [:span.file-label (or file-name \"Choose a file...\")]]]])\n     ;; Adds an \"X\" that can be clicked to clear the selected file.\n     ;; (when file-name \n    ;;   [:i.fa.fa-times {:on-click #(reset! csv-data {})}]]]]])\n"]}