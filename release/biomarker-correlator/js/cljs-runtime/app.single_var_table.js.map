{"version":3,"sources":["app/single_var_table.cljs"],"mappings":";AAQA,4CAAA,mFAAA,mDAAA,mFAAA,yDAAA,kEAAA,mFAAA,kEAAA,mFAAA,mDAAA,mFAAA,wDAAA,4DAAA,mFAAA,2DAAA,gFAAA,mFAAA,oEAAA,mFAAA,kEAAA,mFAAA,mDAAA,mFAAA,6DAAA,kEAAA,mFAAA,vxDAAKA,u2DAO8CC;AAGnD,uCAAA,iFAAA,qEAAA,6DAAA,1PAAKC;AAGL;;;;4CAAA,5CAAMC,gGAGHC;AAHH,AAIE,sDAAA,WAAAC,1DAACC;AAAD,AAAS,QAAG,AAAA,yFAAU,AAAA,8GAAAD,qBACVE;GACJH;;AAKV;;;;0CAAA,1CAAMI,4FAKHC;AALH,AAME,GAAI,iBAAA,hBAAMA;AAAV;;AAEE,OAACC,+CAAOC,iBAAE,4CAAA,WAAAC,vDAACC;AAAD,AAAM,GAAI,qOAAA,pOAAM,AAAA,iGAAc,AAAA,8GAAAD;AAAxB;;AAAA;;GACDH;;;AAGnB,oDAAA,pDAAMK,gHAQHC,KAAKC,aAAaC,QAAQC,cAAcC;AAR3C,AASE,IAAMC,mCACA,iBAAAC,WAAS,AAACC,mBAASN,aAAa,AAACb,0CAAqBY;AAAtD,AAAA,sFAAAM,8BAAAA,5GAACJ,wCAAAA,kDAAAA;;AADP,AAAA,kDAAA,iEAAA,kEAAA,2CAAA,kIAAA,4MAAA,ncAEYA,6KACW,AAACT,wCAAmBY,6FAElB,AAACG,gBAAY,CAAG,AAACb,+CAAOC,iBAAEQ,oBACZ,AAACK,gBAAML,gGAC7B,iBAAAM,qBAAA,0EAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAE,qBAAA,AAAAC,cAAAH;AAAA,AAAA,GAAAE;AAAA,AAAA,IAAAF,eAAAE;AAAA,AAAA,GAAA,AAAAE,6BAAAJ;AAAA,IAAAK,kBAk4EgC,AAAAyE,sBAAA9E;IAl4EhCM,qBAAA,AAAAR,gBAAAO;IAAAE,WAAA,AAAAC,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAG,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAH;AAAA,kBAAA,AAAAI,eAAAL,gBAAAI,7CAAMU;AAAN,AAAA,AAAA,AAAAR,uBAAAJ,SAAA,2CAAA,6MAAA,hJACa,CAACf,8CAAAA,2DAAAA,fAAc2B,uCAAAA,8FACL,AAAA,8GAAqBA;;AAF5C,eAAA,CAAAV,WAAA;;;;AAAA;;;;;AAAA,OAAAG,qBAAA,AAAAC,gBAAAN,UAAA,AAAAO,gEAAA,AAAAC,qBAAAf;;AAAA,OAAAY,qBAAA,AAAAC,gBAAAN,UAAA;;;AAAA,kBAAA,AAAAS,gBAAAhB,9BAAMmB;AAAN,AAAA,OAAAF,eAAA,2CAAA,6MAAA,mNAAA,AAAAH,gEAAA,AAAAI,eAAAlB,lbACa,CAACR,8CAAAA,2DAAAA,fAAc2B,uCAAAA,8FACL,AAAA,8GAAqBA;;;AAF5C;;;;GAAA,KAAA;;AAAA,AAAA,OAAApB,mBAAkBL;;;AAIrC;;;sCAAA,tCAAM0B,oFAMHC,SAASC;AANZ,AAOE,oDAAA,7CAACC,8EAAQ,iBAAAxB,qBAAA,4DAAAyB;AAAA,AAAA,YAAAvB,kBAAA,KAAA;AAAA,AAAA,IAAAuB,eAAAA;;AAAA,AAAA,IAAAtB,qBAAA,AAAAC,cAAAqB;AAAA,AAAA,GAAAtB;AAAA,AAAA,IAAAsB,eAAAtB;AAAA,AAAA,GAAA,AAAAE,6BAAAoB;AAAA,IAAAnB,kBAu3EwC,AAAAyE,sBAAAtD;IAv3ExClB,qBAAA,AAAAR,gBAAAO;IAAAoB,WAAA,AAAAjB,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAoB,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAApB;AAAA,UAAA,AAAAI,eAAAL,gBAAAqB,rCAAME;AAAN,AAAA,IACYC,QAAM,CAACP,4CAAAA,iDAAAA,PAAYM,6BAAAA;AAD/B,AAAA,GAEY,EAAK,GAAK,UAAA,TAAMC,sBAAQ,AAACC,cAAI,AAACC,MAASF;AAFnD,AAAA,AAAAlB,uBAAAc,SAGEI;;AAHF,eAAA,CAAAH,WAAA;;;;AAAA,eAAA,CAAAA,WAAA;;;;;AAAA;;;;;AAAA,OAAAd,qBAAA,AAAAC,gBAAAY,UAAA,AAAAE,kDAAA,AAAAZ,qBAAAS;;AAAA,OAAAZ,qBAAA,AAAAC,gBAAAY,UAAA;;;AAAA,UAAA,AAAAT,gBAAAQ,tBAAMI;AAAN,AAAA,IACYC,QAAM,CAACP,4CAAAA,iDAAAA,PAAYM,6BAAAA;AAD/B,AAAA,GAEY,EAAK,GAAK,UAAA,TAAMC,sBAAQ,AAACC,cAAI,AAACC,MAASF;AAFnD,OAAAZ,qBAAA,AAAAU,kDAAA,AAAAT,eAAAM,vEAGEK;;AAHF,eAAA,AAAAX,eAAAM;;;;;;AAAA;;;;GAAA,KAAA;;AAAA,AAAA,OAAAzB,mBAAUsB;;;AAKrB,6CAAA,7CAAMW,kGAOHjD,aAAasC,SAAS/B,aAAaE;AAPtC,AAUE,IAAMyC,kBAAgB,AAACC,cAAI,4CAAA,WAAAC,vDAAChD;AAAD,AAAM,gGAAAgD,2CAAAA,nIAAC7C,6CAAAA,+DAAAA;GAAgBP;AAAlD,AACE,oDAAA,7CAACwC,gFAAQ,iBAAAxB,qBAAA,mEAAAqC;AAAA,AAAA,YAAAnC,kBAAA,KAAA;AAAA,AAAA,IAAAmC,eAAAA;;AAAA,AAAA,IAAAlC,qBAAA,AAAAC,cAAAiC;AAAA,AAAA,GAAAlC;AAAA,AAAA,IAAAkC,eAAAlC;AAAA,AAAA,GAAA,AAAAE,6BAAAgC;AAAA,IAAA/B,kBAu2EsC,AAAAyE,sBAAA1C;IAv2EtC9B,qBAAA,AAAAR,gBAAAO;IAAAgC,WAAA,AAAA7B,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAgC,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAhC;AAAA,cAAA,AAAAI,eAAAL,gBAAAiC,zCAAM/C;AAAN,AAAA,AAAA,AAAAoB,uBAAA0B,SAAA,mFACG9C,QAAQ,AAACH,kDACCL,aAAaO,aAAaC,QAAQC,cAClC,AAAC4B,oCAAeC,SAAS9B;;AAHtC,eAAA,CAAA+C,WAAA;;;;AAAA;;;;;AAAA,OAAA1B,qBAAA,AAAAC,gBAAAwB,UAAA,AAAAE,yDAAA,AAAAxB,qBAAAqB;;AAAA,OAAAxB,qBAAA,AAAAC,gBAAAwB,UAAA;;;AAAA,cAAA,AAAArB,gBAAAoB,1BAAM7C;AAAN,AAAA,OAAA0B,eAAA,4PAAA,AAAAsB,yDAAA,AAAArB,eAAAkB,jPACG7C,QAAQ,AAACH,kDACCL,aAAaO,aAAaC,QAAQC,cAClC,AAAC4B,oCAAeC,SAAS9B;;;AAHtC;;;;GAAA,KAAA;;AAAA,AAAA,OAAAQ,mBAAckC;;;AAK3B,kCAAA,mFAAA,mEAAA,2EAAA,nQAAKO;AAEL,mDAAA,nDAAMC,8GAEHpD;AAFH,AAGE,mDAAA,WAAAqD,vDAACvD;AAAD,AAAM,6BAAAuD,iBAAA,mFAAA,1HAACC,wLAA0B,AAAA,uFAAUtD;GACtC,AAAA,0FAAA,AAAA,8GAAA,gBAAA,AAAA,kGAAIA,lHAEA2B;;AAIX;;;;;;;;;;mCAAA,nCAAM4B,8EAUHvD;AAVH,AAWE,IAAME,UAAQ,AAAA,uFAAUF;AAAxB,AAAA,0FAAA,mDAAA,mFAAA,uDAAA,mFAAA,sDAAA,mFAAA,kDAAA,mFAAA,iDAAA,2CAAA,0DAAA,YAAA,mFAAA,gDAAA,2CAAA,kFAAA,mNAAA,mOAAA,mFAAA,kDAAA,mFAAA,iDAAA,2CAAA,0DAAA,ivCAAA,mFAAA,kDAAA,mFAAA,iDAAA,9zEAMsBE,gBAASA,sCACI,AAAA,sFAAQ,AAAA,gGAAaF,0BACxB,AAAA,yFAAU,AAAA,gGAAaA,iZAE1C,8DAAA,mFAAA,kSAAA,mFAAA,mSAAA,mFAAA,8CAAA,yQAAA,jrCAAI,AAACwD,0BAAUC,wBAAavD,gJAExB,AAACwD,iCACC,AAACN,iDAA4BpD,MAC7B,CAACE,wCAAAA,iEAAAA,3BAAQuD,6CAAAA,4JACP,AAAA,sFAAQ,CAACvD,wCAAAA,iEAAAA,3BAAQuD,6CAAAA,+KACN,AAAA,uFAAS,CAACvD,wCAAAA,iEAAAA,3BAAQuD,6CAAAA,0XAG1C,iBAAA/C,qBAAA,yDAAAiD;AAAA,AAAA,YAAA/C,kBAAA,KAAA;AAAA,AAAA,IAAA+C,eAAAA;;AAAA,AAAA,IAAA9C,qBAAA,AAAAC,cAAA6C;AAAA,AAAA,GAAA9C;AAAA,AAAA,IAAA8C,eAAA9C;AAAA,AAAA,GAAA,AAAAE,6BAAA4C;AAAA,IAAA3C,kBAwzEyC,AAAAyE,sBAAA9B;IAxzEzC1C,qBAAA,AAAAR,gBAAAO;IAAA4C,WAAA,AAAAzC,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAA4C,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAA5C;AAAA,QAAA,AAAAI,eAAAL,gBAAA6C,nCAAME;AAAN,AAAA,AAAA,AAAAzC,uBAAAsC,SAAA,mFAAA,iDAAA,2CAAA,oDAMa,gDAAA,HAAKG,6BAAYA;;AAN9B,eAAA,CAAAF,WAAA;;;;AAAA;;;;;AAAA,OAAAtC,qBAAA,AAAAC,gBAAAoC,UAAA,AAAAE,+CAAA,AAAApC,qBAAAiC;;AAAA,OAAApC,qBAAA,AAAAC,gBAAAoC,UAAA;;;AAAA,QAAA,AAAAjC,gBAAAgC,pBAAMI;AAAN,AAAA,OAAAnC,eAAA,mFAAA,iDAAA,2CAAA,wIAAA,AAAAkC,+CAAA,AAAAjC,eAAA8B,lJAMa,gDAAA,HAAKI,6BAAYA;;;AAN9B;;;;GAAA,KAAA;;AAAA,AAAA,OAAArD,mBAAQ,eAII,AAAA,WAAAsD,1BACAC;AADA,AAAE,6BAAAD,tBAACV,uCAAcH;mOAJjBnD,lHAEA2B,9GAEA,AAAA,8GAAA,gBAAA,AAAA;aAGb,iBAAAjB,qBAAA,yDAAAwD;AAAA,AAAA,YAAAtD,kBAAA,KAAA;AAAA,AAAA,IAAAsD,eAAAA;;AAAA,AAAA,IAAArD,qBAAA,AAAAC,cAAAoD;AAAA,AAAA,GAAArD;AAAA,AAAA,IAAAqD,eAAArD;AAAA,AAAA,GAAA,AAAAE,6BAAAmD;AAAA,IAAAlD,kBAizE0C,AAAAyE,sBAAAvB;IAjzE1CjD,qBAAA,AAAAR,gBAAAO;IAAAmD,WAAA,AAAAhD,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAmD,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAnD;AAAA,mBAAA,AAAAI,eAAAL,gBAAAoD,9CAAM1E;AAAN,AAAA,AAAA,AAAA4B,uBAAA6C,SAEE,iBAAMK,OAAK,AAACC,eAAK,AAAA,2FAAW/E;AAA5B,AAAA,0FAAA,kDAAA,2CAAA,mFAAA,mFAAA,iDAAA,0GAAA,mFAAA,gDAAA,2CAAA,3bACa,MAAA,LAAK8E,qPACTE,0PACW,CAAA,IAASF,uBAAOA,aAC3B,AAAA,iGAAc,AAAA,8GAAqB9E,+BACzC,iBAAAgB,qBAAA;8EAAAiE;AAAA,AAAA,YAAA/D,kBAAA,KAAA;;AAAA,AAAA,IAAA+D,eAAAA;;AAAA,AAAA,IAAA9D,yBAAA,AAAAC,cAAA6D;AAAA,AAAA,GAAA9D;AAAA,AAAA,IAAA8D,eAAA9D;AAAA,AAAA,GAAA,AAAAE,6BAAA4D;AAAA,IAAA3D,sBA0yEqC,AAAAyE,sBAAAd;IA1yErC1D,yBAAA,AAAAR,gBAAAO;IAAA4D,WAAA,AAAAzD,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAA4D,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAA5D;AAAA,IAAA6D,aAAA,AAAAzD,eAAAL,oBAAA6D;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAAOf;QAAP,AAAAgB,4CAAAD,WAAA,IAAA,/DAASU;AAAT,AAAA,AAAA,AAAAlE,uBAAAsD,SAAA,mFAAA,iDAAA,2CAAA,oDAEa,MAAA,LAAKJ,qDAAST,qBAAIyB;;AAF/B,eAAA,CAAAX,WAAA;;;;AAAA;;;;;AAAA,OAAAtD,qBAAA,AAAAC,gBAAAoD,UAAA,AAAAI,6DAAA,AAAAtD,qBAAAiD;;AAAA,OAAApD,qBAAA,AAAAC,gBAAAoD,UAAA;;;AAAA,IAAAK,aAAA,AAAAtD,gBAAAgD;QAAA,AAAAI,4CAAAE,WAAA,IAAA,/DAAOlB;QAAP,AAAAgB,4CAAAE,WAAA,IAAA,/DAASO;AAAT,AAAA,OAAA5D,eAAA,mFAAA,iDAAA,2CAAA,yIAAA,AAAAoD,6DAAA,AAAAnD,eAAA8C,jKAEa,MAAA,LAAKH,qDAAST,qBAAIyB;;;AAF/B;;;;;CAAA,KAAA;;;AAAA,AAAA,OAAA9E,mBAAY,AAAC4C,sBAAY,AAAA,8GAAqB5D,cACrByD;;;;AAR9B,eAAA,CAAAiB,WAAA;;;;AAAA;;;;;AAAA,OAAA7C,qBAAA,AAAAC,gBAAA2C,UAAA,AAAAE,+CAAA,AAAA3C,qBAAAwC;;AAAA,OAAA3C,qBAAA,AAAAC,gBAAA2C,UAAA;;;AAAA,mBAAA,AAAAxC,gBAAAuC,/BAAMxE;AAAN,AAAA,OAAAkC,eAEE,iBAAM4C,OAAK,AAACC,eAAK,AAAA,2FAAW/E;AAA5B,AAAA,0FAAA,kDAAA,2CAAA,mFAAA,mFAAA,iDAAA,0GAAA,mFAAA,gDAAA,2CAAA,3bACa,MAAA,LAAK8E,qPACTE,0PACW,CAAA,IAASF,uBAAOA,aAC3B,AAAA,iGAAc,AAAA,8GAAqB9E,+BACzC,iBAAAgB,qBAAA;8EAAAwE;AAAA,AAAA,YAAAtE,kBAAA,KAAA;AAAA,AAAA,IAAAsE,eAAAA;;AAAA,AAAA,IAAArE,yBAAA,AAAAC,cAAAoE;AAAA,AAAA,GAAArE;AAAA,AAAA,IAAAqE,eAAArE;AAAA,AAAA,GAAA,AAAAE,6BAAAmE;AAAA,IAAAlE,kBA0yEqC,AAAAyE,sBAAAP;IA1yErCjE,qBAAA,AAAAR,gBAAAO;IAAAmE,WAAA,AAAAhE,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAmE,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAnE;AAAA,IAAAoE,aAAA,AAAAhE,eAAAL,gBAAAoE;QAAA,AAAAL,4CAAAM,WAAA,IAAA,/DAAOtB;QAAP,AAAAgB,4CAAAM,WAAA,IAAA,/DAASG;AAAT,AAAA,AAAA,AAAAlE,uBAAA6D,SAAA,mFAAA,iDAAA,2CAAA,oDAEa,MAAA,LAAKX,qDAAST,qBAAIyB;;AAF/B,eAAA,CAAAJ,WAAA;;;;AAAA;;;;;AAAA,OAAA7D,qBAAA,AAAAC,gBAAA2D,UAAA,AAAAG,6DAAA,AAAA5D,qBAAAwD;;AAAA,OAAA3D,qBAAA,AAAAC,gBAAA2D,UAAA;;;AAAA,IAAAI,aAAA,AAAA5D,gBAAAuD;QAAA,AAAAH,4CAAAQ,WAAA,IAAA,/DAAOxB;QAAP,AAAAgB,4CAAAQ,WAAA,IAAA,/DAASC;AAAT,AAAA,OAAA5D,eAAA,mFAAA,iDAAA,2CAAA,yIAAA,AAAA0D,6DAAA,AAAAzD,eAAAqD,jKAEa,MAAA,LAAKV,qDAAST,qBAAIyB;;;AAF/B;;;;GAAA,KAAA;;;AAAA,AAAA,OAAA9E,mBAAY,AAAC4C,sBAAY,AAAA,8GAAqB5D,cACrByD;;KAR9B,AAAAkB,+CAAA,AAAAxC,eAAAqC;;;AAAA;;;;GAAA,KAAA;;AAAA,AAAA,OAAAxD,mBAAmB,gDAAA,WAAA4D,3DAACC;AAAD,AAAU,OAAA,iGAAc,AAAA,8GAAAD;GACf,AAAA,kGAAetE","names":["app.single-var-table/OneToManyCorrelation","app.stats/CorrelationResults","app.single-var-table/aggregate-names","app.single-var-table/filter-insignificant","rows","p1__49376#","cljs.core.filter","app.stats/p-value-cutoff","app.single-var-table/calc-counted-score","correlations","cljs.core.reduce","cljs.core/+","p1__49377#","cljs.core.map","app.single-var-table/get-significant-correlations","data","one-var-type","one-var","many-var-type","one-var-raw-data","one-var-significant-correlations","G__49383","cljs.core/group-by","app.stats/round","cljs.core/count","iter__4652__auto__","s__49385","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","b__49387","cljs.core/chunk-buffer","i__49386","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__49384","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","correlation","app.single-var-table/get-csv-values","csv-data","column-name","cljs.core.into","s__49390","b__49392","i__49391","iter__49389","row","value","cljs.core/not","js/isNaN","app.single-var-table/make-all-correlations","unique-one-vars","cljs.core/set","p1__49393#","s__49396","b__49398","i__49397","iter__49395","app.single-var-table/table-keys","app.single-var-table/get-one-var-timeseries-data","p1__49401#","cljs.core/select-keys","app.single-var-table/make-hiccup","cljs.core/contains?","app.biomarker-data/data","app.biomarker-data/make-acm-plot","s__49410","b__49412","i__49411","iter__49409","k","p1__49402#","cljs.core/keys","s__49414","b__49416","i__49415","iter__49413","p1__49403#","cljs.core.sort_by","mvar","cljs.core/name","app.ui/hover-to-render","s__49422","b__49424","i__49423","vec__49425","cljs.core.nth","iter__49421","vec__49429","s__49437","b__49439","i__49438","vec__49440","iter__49436","vec__49444","v","cljs.core/chunk-first"],"sourcesContent":["(ns app.single-var-table\n  (:require\n    [app.stats :as stats]\n    [app.specs :as specs]\n    [app.biomarker-data :as biodata]\n    [app.csv-data-processing :as proc]\n    [app.ui :as ui]))\n\n(def OneToManyCorrelation\n  [:map [:one-var :keyword]\n        [:aggregates [:map [:score :int]\n                           [:average :double]]]\n                           ; [:acm-score :double]]]\n        [:correlations [:sequential\n                        [:map [:many-var :keyword]\n                              [:regression-results stats/CorrelationResults]]]]])\n\n; TODO generate these from the OneToManyCorrelation spec above\n(def aggregate-names #{:score :average :acm-score})\n\n\n(defn filter-insignificant\n  \"Filter row maps from the input that show statistically insignificant\n  correlations\"\n  [rows]\n  (filter #(< (:p-value (:regression-results %))\n              stats/p-value-cutoff)\n          rows))\n\n; TODO we may need to introduce a concept of \"up is good\" and \"down is bad\" so\n; that this score instead takes the difference between \"good\" and \"bad\"\n; correlations, not just positive and negative ones.\n(defn calc-counted-score\n  \"Sums up all postive correlations and all negatives correlations, then takes\n  the difference.\"\n  {:malli/schema [:=> [:cat [:or :nil stats/PairwiseCorrelations]]\n                  :int]}\n  [correlations]\n  (if (nil? correlations)\n    0\n    (reduce + (map #(if (neg? (:correlation (:regression-results %))) -1 1)\n                   correlations))))\n\n\n(defn get-significant-correlations\n  {:malli/schema [:=> [:cat\n                       stats/PairwiseCorrelations\n                       :keyword\n                       :keyword\n                       :keyword\n                       [:vector :double]]\n                  OneToManyCorrelation]}\n  [data one-var-type one-var many-var-type one-var-raw-data]\n  (let [one-var-significant-correlations\n        (one-var (group-by one-var-type (filter-insignificant data)))]\n    {:one-var one-var\n     :aggregates {:score (calc-counted-score one-var-significant-correlations)\n                  ; :acm-score 0\n                  :average (stats/round (/ (reduce + one-var-raw-data)\n                                         (count one-var-raw-data)))}\n     :correlations (for [correlation one-var-significant-correlations]\n                     {:many-var (many-var-type correlation)\n                      :regression-results (:regression-results correlation)})}))\n\n(defn get-csv-values\n  \"Filters NaNs while getting the data.\"\n  {:malli/schema [:=> [:cat\n                       [:sequential [:map-of :keyword :any]]\n                       :keyword]\n                  [:vector :double]]}\n  [csv-data column-name]\n  (into [] (for [row csv-data\n                 :let [value (column-name row)]\n                 :when (and (not (nil? value)) (not (js/isNaN value)))]\n             value)))\n\n(defn make-all-correlations\n  {:malli/schema [:=> [:cat\n                       stats/PairwiseCorrelations\n                       [:sequential proc/ProcessedRow]\n                       :keyword\n                       :keyword]\n                  [:map-of :keyword OneToManyCorrelation]]}\n  [correlations csv-data one-var-type many-var-type]\n  ; [::pairwise-correlations keyword? keyword?\n  ;  => ::one-to-many-correlations]\n  (let [unique-one-vars (set (map #(one-var-type %) correlations))]\n    (into {} (for [one-var unique-one-vars]\n               [one-var (get-significant-correlations\n                          correlations one-var-type one-var many-var-type\n                          (get-csv-values csv-data one-var))]))))\n\n(def table-keys [:correlation :rounded-p-value :datapoints])\n\n(defn get-one-var-timeseries-data\n  {:malli/schema [:=> [:cat OneToManyCorrelation] biodata/TimeseriesData]}\n  [data]\n  (map #(select-keys % [:timestamp (:one-var data)])\n       (-> data\n           :correlations\n           first\n           :regression-results\n           :raw-data)))\n\n(defn make-hiccup\n  \"Creates a table like this:\n           Input\n        Aggregate 1\n        Aggregate 2\n  Biomarker | r | p | n\n  data      | 0 | 0 | 0\n  ...\n  \"\n  {:malli/schema [:=> [:cat OneToManyCorrelation] specs/ReagentComponent]}\n  [data]\n  (let [one-var (:one-var data)]\n    [:div\n      [:table\n        [:tbody\n    ;  https://www.w3schools.com/html/html_table_headers.asp\n         [:tr [:th {:colSpan 4}\n               [:a {:id one-var} one-var]\n               \", Counted score of \" (:score (:aggregates data))\n               \", Average value \" (:average (:aggregates data))]]\n         [:tr [:td {:colSpan 4}\n               (if (contains? biodata/data one-var)\n                 [:div\n                   (biodata/make-acm-plot\n                     (get-one-var-timeseries-data data)\n                     (one-var biodata/data))\n                   [:p (:notes (one-var biodata/data))]\n                   [:p \"Source: \" (:source (one-var biodata/data))]]\n                 \"No data found for this metric.\")]]\n         [:tr [:th \"Correlate\"]\n          (for [k (-> data\n                      :correlations\n                      first\n                      :regression-results\n                      (#(select-keys % table-keys))\n                      keys)]\n            [:th {:key (str k \"-head\")} k])]\n         (for [correlations (sort-by #(:correlation (:regression-results %))\n                                     (:correlations data))]\n           (let [mvar (name (:many-var correlations))]\n             [:tr {:key (str mvar \"-row\")} \n              [:td [ui/hover-to-render\n                    [:a {:href (str \"#\" mvar)} mvar]\n                    (:scatterplot (:regression-results correlations))]]\n              (for [[k v] (select-keys (:regression-results correlations)\n                                       table-keys)]\n                [:td {:key (str mvar \"-\" k)} v])]))]]]))\n"]}